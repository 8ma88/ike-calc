<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ± ã®è¦‹ç©ã‚Šè¨ˆç®— v6.2</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; padding: 10px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding-bottom: 60px; }
        
        h1 { text-align: center; font-size: 1.3rem; color: #1a73e8; margin-bottom: 15px; }
        
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; position: relative; }
        .input-row { display: flex; gap: 8px; margin-bottom: 10px; align-items: flex-end; }
        .input-group { flex: 1; }
        .input-group.small { flex: 0.7; }
        
        label { display: block; font-size: 0.8rem; font-weight: bold; color: #666; margin-bottom: 4px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; background: #fafafa; }
        input:focus { border-color: #1a73e8; outline: none; background: #fff; }

        .btn-add { background-color: #e8f0fe; color: #1a73e8; border: none; padding: 10px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-delete { background-color: #ffcccc; color: #d32f2f; border: none; width: 30px; height: 30px; border-radius: 50%; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-bottom: 12px;}

        .btn-calc { background-color: #1a73e8; color: white; border: none; padding: 16px; width: 100%; border-radius: 10px; font-size: 1.2rem; font-weight: bold; margin-top: 20px; box-shadow: 0 4px 10px rgba(26, 115, 232, 0.3); cursor: pointer; }
        .btn-calc:active { transform: scale(0.98); }

        /* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .result-container { display: none; margin-top: 20px; }
        
        .area-detail-card { background: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .area-list { font-size: 0.9rem; margin-bottom: 10px; }
        .area-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #eee; padding-bottom: 2px; margin-bottom: 4px;}
        .area-total { display: flex; justify-content: space-between; font-weight: bold; color: #333; border-top: 1px solid #eee; padding-top: 5px; }

        /* æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ« */
        .compare-table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .compare-table th { background: #f8f9fa; padding: 10px; font-size: 0.85rem; color: #555; text-align: center; border-bottom: 2px solid #ddd; width: 50%; }
        .compare-table td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; vertical-align: top; }
        
        .price-lg { font-size: 1.4rem; font-weight: bold; color: #d93025; display: block; text-align: center; margin-bottom: 8px;}
        
        .detail-list { font-size: 0.8rem; color: #444; }
        .detail-item { display: flex; justify-content: space-between; margin-bottom: 4px; border-bottom: 1px dashed #f0f0f0; align-items: baseline; }
        .detail-item span:last-child { font-weight: bold; white-space: nowrap; margin-left: 5px; }
        .detail-label { font-size: 0.75rem; color: #666; }
        
        .sub-cost { font-size: 0.75rem; color: #888; font-weight: normal !important;}

        .diff-badge { background: #d93025; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 10px; display: block; margin: 0 auto 5px auto; width: fit-content; animation: pop 1s infinite alternate; }
        @keyframes pop { from { transform: scale(1); } to { transform: scale(1.1); } }
        
        .guts-mark { color: #f57c00; font-size: 0.7rem; border: 1px solid #ffe0b2; background:#fff3e0; padding: 0 3px; border-radius: 4px; margin-left: 3px; }
        
        .section-title { font-size: 1rem; font-weight: bold; margin: 20px 0 10px 0; border-left: 4px solid #333; padding-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>æ± ã®è¦‹ç©ã‚Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v6.2</h1>
    <div style="text-align:center; font-size:0.8rem; color:#666; margin-bottom:10px;">å®‰å…¨ç­–(æ¨™æº–) vs å‹è² ç­–(æ”»ã‚) å†…è¨³è©³ç´°ç‰ˆ</div>
    
    <div class="card">
        <label>æ± ã®åç§°</label>
        <input type="text" id="pondName" placeholder="ä¾‹ï¼šé“æ± ">
    </div>

    <div class="section-title">1. å¹³é¢ã‚¨ãƒªã‚¢ (æ©Ÿæ¢°)</div>
    <div id="flat-container"></div>
    <button class="btn-add" onclick="addFlatRow()">ï¼‹ å¹³é¢ã‚¨ãƒªã‚¢ã‚’è¿½åŠ </button>

    <div class="section-title">2. æ³•é¢ã‚¨ãƒªã‚¢ (æ‰‹åˆˆã‚Š)</div>
    <div id="slope-container"></div>
    <button class="btn-add" onclick="addSlopeRow()">ï¼‹ æ³•é¢ã‚¨ãƒªã‚¢ã‚’è¿½åŠ </button>

    <button class="btn-calc" onclick="calculate()">æ¯”è¼ƒè¦‹ç©ã‚Šã‚’ä½œæˆ</button>

    <div id="resultArea" class="result-container">
        
        <div class="area-detail-card">
            <div style="font-size:0.9rem; font-weight:bold; color:#1a73e8; margin-bottom:5px;">é¢ç©å†…è¨³</div>
            <div id="flatDetailList" class="area-list"></div>
            <div id="slopeDetailList" class="area-list"></div>
            <div class="area-total" style="margin-top:5px;">
                <span>ç·åˆè¨ˆé¢ç©:</span>
                <span><span id="grandTotalArea">0</span> ã¡</span>
            </div>
        </div>

        <h3 style="text-align:center; margin-bottom:5px;">ãƒ—ãƒ©ãƒ³A: ãƒãƒ³ãƒãƒ¼ãƒŠã‚¤ãƒ•ã®ã¿</h3>
        <div style="text-align:center; font-size:0.8rem; color:#666; margin-bottom:10px;">(ç‹­ã„å ´æ‰€å‘ã‘ / ç©è¼‰è»Šä¸è¦)</div>
        
        <table class="compare-table">
            <thead>
                <tr>
                    <th style="border-top: 3px solid #1a73e8;">ğŸ›¡ï¸ å®‰å…¨ç­–<br><span style="font-weight:normal; font-size:0.7rem;">æ¨™æº–(ã„ã¤ã‚‚ã®)</span></th>
                    <th style="border-top: 3px solid #f57c00; background:#fff8e1;">ğŸ”¥ å‹è² ç­–<br><span style="font-weight:normal; font-size:0.7rem;">20%åŠ¹ç‡UP</span></th>
                </tr>
            </thead>
            <tbody id="tableA">
                </tbody>
        </table>

        <h3 style="text-align:center; margin-top:30px; margin-bottom:5px;">ãƒ—ãƒ©ãƒ³B: ãƒ•ãƒ¬ãƒ¼ãƒ«ãƒ¢ã‚¢ä½µç”¨</h3>
        <div style="text-align:center; font-size:0.8rem; color:#666; margin-bottom:10px;">(å¹…åºƒå‘ã‘ / è¦ç©è¼‰è»Š / 2.5å€é€Ÿ)</div>

        <table class="compare-table">
            <thead>
                <tr>
                    <th style="border-top: 3px solid #1a73e8;">ğŸ›¡ï¸ å®‰å…¨ç­–<br><span style="font-weight:normal; font-size:0.7rem;">æ¨™æº–(ã„ã¤ã‚‚ã®)</span></th>
                    <th style="border-top: 3px solid #f57c00; background:#fff8e1;">ğŸ”¥ å‹è² ç­–<br><span style="font-weight:normal; font-size:0.7rem;">20%åŠ¹ç‡UP</span></th>
                </tr>
            </thead>
            <tbody id="tableB">
                </tbody>
        </table>
        
        <div style="font-size:0.75rem; color:#888; margin-top:15px; padding:10px; background:#fff; border-radius:8px;">
            <b>æ¡ä»¶ã®é•ã„:</b><br>
            [å®‰å…¨ç­–] æ³•é¢600ã¡/æ—¥, ãƒãƒ³ãƒãƒ¼2000ã¡/æ—¥<br>
            [å‹è² ç­–] æ³•é¢720ã¡/æ—¥, ãƒãƒ³ãƒãƒ¼2400ã¡/æ—¥<br>
            â€»äººä»¶è²»ã¯ã€æ©Ÿæ¢°ç¨¼åƒã®å®Ÿåƒæ™‚é–“ã‚’åŠ å‘³ã—ã¦è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚
        </div>
    </div>
</div>

<script>
    window.onload = function() {
        addFlatRow();
        addSlopeRow();
    };

    function addFlatRow() {
        const div = document.createElement('div');
        div.className = 'card input-row flat-row';
        div.innerHTML = `
            <div class="input-group">
                <label>å ´æ‰€</label>
                <input type="text" class="val-name" placeholder="æ±å´">
            </div>
            <div class="input-group small">
                <label>é•·ã•</label>
                <input type="number" class="val-len" placeholder="0">
            </div>
            <div class="input-group small">
                <label>å¹…</label>
                <input type="number" class="val-width" placeholder="0">
            </div>
            <button class="btn-delete" onclick="this.parentElement.remove()">Ã—</button>
        `;
        document.getElementById('flat-container').appendChild(div);
    }

    function addSlopeRow() {
        const div = document.createElement('div');
        div.className = 'card input-row slope-row';
        div.innerHTML = `
            <div class="input-group">
                <label>å ´æ‰€</label>
                <input type="text" class="val-name" placeholder="å†…æ³•é¢">
            </div>
            <div class="input-group small">
                <label>é•·ã•</label>
                <input type="number" class="val-len" placeholder="0">
            </div>
            <div class="input-group small">
                <label>é«˜ã•</label>
                <input type="number" class="val-height" placeholder="0">
            </div>
            <button class="btn-delete" onclick="this.parentElement.remove()">Ã—</button>
        `;
        document.getElementById('slope-container').appendChild(div);
    }

    // é ‘å¼µã‚Šè¨ˆç®—ï¼ˆ15%ã¾ã§ã¯åˆ‡ã‚Šæ¨ã¦ï¼‰
    function smartCeil(value) {
        const integerPart = Math.floor(value);
        const decimalPart = value - integerPart;
        const cleanDecimal = parseFloat(decimalPart.toFixed(4));
        if (cleanDecimal > 0 && cleanDecimal <= 0.15) {
            return { val: integerPart, guts: true };
        }
        return { val: Math.ceil(value), guts: false };
    }

    // è¨ˆç®—ãƒ¡ã‚¤ãƒ³
    function calculate() {
        // --- ãƒ‡ãƒ¼ã‚¿å–å¾— ---
        let totalSlopeArea = 0;
        let slopeDetailHtml = '';
        document.querySelectorAll('.slope-row').forEach(row => {
            const name = row.querySelector('.val-name').value || '-';
            const l = parseFloat(row.querySelector('.val-len').value) || 0;
            const h = parseFloat(row.querySelector('.val-height').value) || 0;
            const area = l * h;
            if (area > 0) {
                totalSlopeArea += area;
                slopeDetailHtml += `<div class="area-row"><span>æ³•é¢:${name}</span> <span>${area.toLocaleString()}ã¡</span></div>`;
            }
        });

        let totalFlatArea = 0;
        let flatDetailHtml = '';
        let flats = []; 
        document.querySelectorAll('.flat-row').forEach(row => {
            const name = row.querySelector('.val-name').value || '-';
            const l = parseFloat(row.querySelector('.val-len').value) || 0;
            const w = parseFloat(row.querySelector('.val-width').value) || 0;
            const area = l * w;
            if (area > 0) {
                totalFlatArea += area;
                flatDetailHtml += `<div class="area-row"><span>å¹³é¢:${name}</span> <span>${area.toLocaleString()}ã¡</span></div>`;
                flats.push({ area: area, width: w });
            }
        });

        // é¢ç©è¡¨ç¤º
        document.getElementById('flatDetailList').innerHTML = flatDetailHtml;
        document.getElementById('slopeDetailList').innerHTML = slopeDetailHtml;
        document.getElementById('grandTotalArea').innerText = (totalFlatArea + totalSlopeArea).toLocaleString();
        document.getElementById('resultArea').style.display = 'block';

        // --- 2ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¨ˆç®—ã‚’å®Ÿè¡Œ ---
        const resSafe = calcScenario(flats, totalSlopeArea, {
            slopeCap: 600,     
            hammerCap: 2000,   
            hammerSpeed: 4000, 
            flailCap: 5000,    
            flailSpeed: 10000  
        });

        const resAgg = calcScenario(flats, totalSlopeArea, {
            slopeCap: 720,     
            hammerCap: 2400,   
            hammerSpeed: 4800, 
            flailCap: 6000,    
            flailSpeed: 12000  
        });

        // --- ãƒ†ãƒ¼ãƒ–ãƒ«æç”» ---
        renderTable('tableA', resSafe.planA, resAgg.planA);
        renderTable('tableB', resSafe.planB, resAgg.planB);
    }

    // ã‚·ãƒŠãƒªã‚ªã”ã¨ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
    function calcScenario(flats, slopeTotal, settings) {
        const slopeDays = slopeTotal / settings.slopeCap;

        // ãƒ—ãƒ©ãƒ³A (ãƒãƒ³ãƒãƒ¼ã®ã¿)
        let a_DaysBill = 0;
        let a_WorkLoad = 0;
        // ãƒ—ãƒ©ãƒ³B (ãƒ•ãƒ¬ãƒ¼ãƒ«ä½µç”¨)
        let b_DaysBill = 0;
        let b_WorkLoad = 0;

        flats.forEach(f => {
            // A: å…¨ã¦ãƒãƒ³ãƒãƒ¼
            a_DaysBill += f.area / settings.hammerCap;
            a_WorkLoad += f.area / settings.hammerSpeed;

            // B: å¹…åˆ¤å®š
            if (f.width >= 2.0) {
                b_DaysBill += f.area / settings.flailCap;
                b_WorkLoad += f.area / settings.flailSpeed;
            } else {
                b_DaysBill += f.area / settings.hammerCap;
                b_WorkLoad += f.area / settings.hammerSpeed;
            }
        });

        const calcPlan = (dBill, wLoad) => {
            const days = Math.ceil(dBill);
            const laborRes = smartCeil(wLoad + slopeDays);
            return { days: days, labor: laborRes.val, guts: laborRes.guts };
        };

        return {
            planA: calcPlan(a_DaysBill, a_WorkLoad),
            planB: calcPlan(b_DaysBill, b_WorkLoad)
        };
    }

    // ãƒ†ãƒ¼ãƒ–ãƒ«æç”»é–¢æ•°
    function renderTable(tableId, safe, agg) {
        const unitMachineA = 20000; 
        const unitMachineB = 60000; 
        const unitLabor = 25000;

        // ãƒ—ãƒ©ãƒ³åˆ¤å®šã¨è¡¨ç¤ºãƒ©ãƒ™ãƒ«ã®è¨­å®š
        const isPlanA = (tableId === 'tableA');
        const unitMachine = isPlanA ? unitMachineA : unitMachineB;
        
        // å†…è¨³ãƒ†ã‚­ã‚¹ãƒˆã®åˆ‡ã‚Šæ›¿ãˆ
        const machineLabel = isPlanA ? "æ©Ÿæ¢°ä»£(2ä¸‡):" : "æ©Ÿæ¢°ä»£(ãƒ•3ä¸‡+ãƒ2ä¸‡+ç©1ä¸‡):";
        const laborLabel = "äººä»¶è²»(2.5ä¸‡):";

        // ã‚³ã‚¹ãƒˆè¨ˆç®—
        const safeMachineCost = safe.days * unitMachine;
        const safeLaborCost = safe.labor * unitLabor;
        const safeTotal = safeMachineCost + safeLaborCost;

        const aggMachineCost = agg.days * unitMachine;
        const aggLaborCost = agg.labor * unitLabor;
        const aggTotal = aggMachineCost + aggLaborCost;
        
        const diff = safeTotal - aggTotal;
        const diffBadge = diff > 0 ? `<div class="diff-badge">Â¥${diff.toLocaleString()} ãŠå¾—!</div>` : '';

        // é ‘å¼µã‚Šãƒãƒ¼ã‚¯
        const gutsHtml = (g) => g ? '<span class="guts-mark">æ®‹æ¥­è¾¼</span>' : '';

        // HTMLç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼ (å†…è¨³è¡¨ç¤ºã‚’v5.0é¢¨ã«è©³ç´°åŒ–)
        const renderDetail = (days, labor, mCost, lCost, guts) => `
            <div class="detail-list">
                <div class="detail-item">
                    <span>æ©Ÿæ¢°å·¥æœŸ:</span>
                    <span>${days}æ—¥</span>
                </div>
                <div class="detail-item">
                    <span>å¿…è¦äººå·¥:</span>
                    <span>${labor}äºº${gutsHtml(guts)}</span>
                </div>
                <hr style="margin:5px 0; border:0; border-top:1px dashed #eee;">
                <div class="detail-item">
                    <span class="detail-label">${machineLabel}</span>
                    <span>Â¥${mCost.toLocaleString()}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">${laborLabel}</span>
                    <span>Â¥${lCost.toLocaleString()}</span>
                </div>
            </div>
        `;

        const html = `
            <tr>
                <td>
                    <span class="price-lg">Â¥${safeTotal.toLocaleString()}</span>
                    ${renderDetail(safe.days, safe.labor, safeMachineCost, safeLaborCost, safe.guts)}
                </td>
                <td style="background:#fff8e1;">
                    ${diffBadge}
                    <span class="price-lg">Â¥${aggTotal.toLocaleString()}</span>
                    ${renderDetail(agg.days, agg.labor, aggMachineCost, aggLaborCost, agg.guts)}
                </td>
            </tr>
        `;
        document.getElementById(tableId).innerHTML = html;
    }
</script>

</body>
</html>